---
title: 设计模式学习
createTime: 2024/12/24 17:16:14
permalink: /编程随想/设计模式学习/
tags:
    - '设计模式'
---

## 简介

设计模式（Design Patterns）是软件工程中经过实践验证的、用于解决特定设计问题的可重用方案。它们代表了软件开发领域的最佳实践，最早由 "四人帮"（Gang of Four，简称 GoF）在其著作《设计模式：可复用面向对象软件的基础》中系统化提出。

设计模式的核心价值在于：

- **提高代码复用性**：通过抽象共同的解决方案，降低重复开发成本
- **增强系统可维护性**：采用标准化的设计方案，使代码结构更清晰
- **优化系统架构**：通过解耦和抽象，提升系统的灵活性和可扩展性
- **促进团队协作**：为开发团队提供通用的设计词汇和交流语言
- **遵循设计原则**：践行 SOLID、DRY、KISS 等面向对象设计原则

合理运用设计模式能够有效地解决软件开发中的常见问题，但也要注意避免过度设计，应该根据实际业务场景选择恰当的模式。

### 单例模式（Singleton Pattern）

单例模式是一种创建型设计模式，它确保一个类只有一个实例，并提供一个全局访问点来访问该实例。这种模式在需要严格控制全局状态或共享资源时特别有用。

#### 核心特征

- **单一实例保证**：确保类在整个应用程序生命周期中只存在一个实例，无论创建多少次
- **全局访问点**：提供一个静态方法作为全局访问点，通常命名为 `getInstance()`
- **私有构造函数**：通过将构造函数声明为私有，防止外部直接实例化
- **延迟初始化（Lazy Loading）**：支持延迟实例化，仅在首次使用时创建实例，优化资源使用

#### 适用场景

- 管理共享资源（如数据库连接池、线程池）
- 控制全局配置信息
- 管理系统日志记录器
- 设备驱动程序的访问点

#### 实现注意事项

- 需考虑多线程环境下的线程安全问题
- 注意序列化和反序列化时的单例性维护
- 考虑是否需要支持延迟加载
- 权衡双重检查锁定（Double-Checked Locking）的使用

#### TypeScript 实现实例

以下是三个典型的单列模式实现的实例，分别对应不同的应用场景

##### 1. 数据库连接管理器

最基础的单列模式实现，用于管理数据库连接

``` typescript

class DatabaseConnection {

    private static instance: DatabaseConnection;

    private isConnected: boolean = false;

    private constructor () {}

    public static getInstance () : DatabaseConnection {
        if ( !DatabaseConnection.instance ) {
            DatabaseConnection.instance = new DatabaseConnection();
        }

        return DatabaseConnection.instance;
    }

    public connect (): void {
        if ( !this.isConnected ) {
            console.log( '建立数据库连接中...' );
            this.isConnected = true;
        }
    }

    public query (sql: string): void {
        if ( this.isConnected ) {
            console.log( `执行 SQL: ${sql}` )
        } else {
            throw new Error( '数据库未连接' )
        }
    }

}

```

``` typescript
 // 使用实例
const db = DatabaseConnection.getInstance();
db.connect();
db.query('SELECT FROM users'); 

```

#### 2. 全局配置管理器

适用于管理应用全局配置的单例实现：

``` typescript

interface AppConfig {
    apiUrl: string;
    theme: 'light' | 'dark';
}

class ConfigManager {
    private static instance: ConfigManager;

    private config: AppConfig;

    private constructor() {
        this.config = {
            apiUrl: "https://api.example.com"
            theme: "light"
        }
    };
    public static getInstance(): ConfigManger {
        if(!ConfigManger.instance) {
            ConfigManager.instance = new ConfigManger();
        }
        return ConfigManager.instance;
    }

    public getConfig():AppConfig{
        return {...this.config};
    }
    public updateConfig(newConfig: Partial<AppConfig>): void {
        this.config = {...this.config, ...newConfig};
    }
}

```

``` typescript
 // 使用用力
 const config = ConfigMannger.getInstance();
 config.updateConfig({theme: 'dark'});
 console.log(config.getConfig());

```

##### 3. 日志记录器

用于统一管理应用日志的单例实现:

``` typescript

type LogLevel = 'info' | 'warn' | 'error';
class Logger {

    private static instance: Logger;

    private logs: string[] = [];

    private constructor() {};

    public static getInstance(): Logger {
        if(!Logger.instance) {
            Logger.instance = new Logger();
        }
        return Logger.instance;
    }

    public log(level: logLevel, message: string): void {
        const timestamp = new Date().toISOString();
        const logMessage = `[${timestamp}] ${level.toUpperCase()}: ${message}`;
        this.logs.push(logMessage);
        console.log(logMessage);
    }

    public getLogs(): string[] {
        return [...this.logs]
    }
}
```

``` typescript
const logger = Logger.getInstance();
logger.log('info','应用启动');
logger.log('error', '发生错误');

```





